<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HaG Toolkit — Dashboard</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <!-- HEADER -->
    <header class="header">
      <div class="wrap">
        <div class="topline">
          <div class="brand">HaG Toolkit</div>
          <div class="stats">
            <div class="pill" id="hdrBudget">Budget: —</div>
            <div class="pill" id="hdrSlots">Slots: —</div>
          </div>
        </div>

        <nav class="navrow">
          <a href="index.html" data-tab="index.html">Dashboard</a>
          <a href="auction.html" data-tab="auction.html">Auction Board</a>
          <a href="roster.html" data-tab="roster.html">Roster</a>
          <a href="projections.html" data-tab="projections.html">Projections</a>
        </nav>
      </div>
    </header>

    <!-- MAIN -->
    <main class="wrap">
      <section class="card">
        <h1>Dashboard</h1>
        <p>
          Your snapshot page. Next we’ll show budget, slots, top targets, and projection totals.
        </p>

        <!-- SETTINGS PANEL -->
        <section class="panel">
          <strong>Settings</strong>
          <p class="small">These are saved in your browser (localStorage).</p>

          <div class="grid">
            <label class="panel half">
              <div class="small">Budget Total</div>
              <input id="setBudgetTotal" type="number" min="0" step="1" />
            </label>

            <label class="panel half">
              <div class="small">Budget Remaining</div>
              <input id="setBudgetRemaining" type="number" min="0" step="1" />
            </label>

            <label class="panel half">
              <div class="small">Hitter Slots Total</div>
              <input id="setHSlots" type="number" min="0" step="1" />
            </label>

            <label class="panel half">
              <div class="small">Pitcher Slots Total</div>
              <input id="setPSlots" type="number" min="0" step="1" />
            </label>
          </div>

          <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
            <button id="btnSaveSettings">Save Settings</button>
            <button id="btnResetSettings" class="ghost" type="button">
              Reset to Defaults
            </button>
            <span id="settingsStatus" class="small"></span>
          </div>
        </section>

        <!-- DASHBOARD CARDS -->
        <section class="grid">
          <div class="panel half">
            <strong>Budget</strong>
            <div class="small" id="budgetText">Loading…</div>
          </div>

          <div class="panel half">
            <strong>Roster Slots</strong>
            <div class="small" id="slotsText">Loading…</div>
          </div>
        </section>
      </section>
    </main>

    <!-- SCRIPT -->
    <script type="module">
      import { setActiveTab, hydrateHeader } from "./js/nav.js";
      import { getSettings, setSettings } from "./js/storage.js";

      // --- init nav + header ---
      setActiveTab();
      hydrateHeader();

      // --- grab elements ---
      const els = {
        total: document.getElementById("setBudgetTotal"),
        remaining: document.getElementById("setBudgetRemaining"),
        hSlots: document.getElementById("setHSlots"),
        pSlots: document.getElementById("setPSlots"),
        save: document.getElementById("btnSaveSettings"),
        reset: document.getElementById("btnResetSettings"),
        status: document.getElementById("settingsStatus"),
        budgetText: document.getElementById("budgetText"),
        slotsText: document.getElementById("slotsText"),
      };

      // --- update dashboard cards ---
      function hydrateDashboardCards() {
        const s = getSettings();
        els.budgetText.textContent =
          `Remaining: $${s.budget_remaining} / Total: $${s.budget_total}`;
        els.slotsText.textContent =
          `Hitters: ${s.hitter_slots_total} • Pitchers: ${s.pitcher_slots_total}`;
      }

      // --- load settings into form ---
      function loadSettingsIntoForm() {
        const s = getSettings();
        els.total.value = s.budget_total;
        els.remaining.value = s.budget_remaining;
        els.hSlots.value = s.hitter_slots_total;
        els.pSlots.value = s.pitcher_slots_total;
      }

      // --- SAVE ---
      els.save.addEventListener("click", () => {
        const next = {
          budget_total: Number(els.total.value),
          budget_remaining: Number(els.remaining.value),
          hitter_slots_total: Number(els.hSlots.value),
          pitcher_slots_total: Number(els.pSlots.value),
        };

        setSettings(next);
        hydrateHeader();
        hydrateDashboardCards();
        loadSettingsIntoForm();

        els.status.textContent = "Saved ✓";
        setTimeout(() => (els.status.textContent = ""), 1500);
      });

      // --- RESET ---
      els.reset.addEventListener("click", () => {
        // IMPORTANT: must match key used in storage.js
        localStorage.removeItem("hag_settings");

        hydrateHeader();
        hydrateDashboardCards();
        loadSettingsIntoForm();

        els.status.textContent = "Reset ✓";
        setTimeout(() => (els.status.textContent = ""), 1500);
      });

      // --- initial load ---
      loadSettingsIntoForm();
      hydrateDashboardCards();
    </script>
  </body>
</html>
